<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bowling Party!!! (Web-App Companion)</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #222;
  color: #fff;
  margin: 0;
  padding: 0;
}
.title-container { margin-top: 20px; }
.title-image { max-width: 90%; height: auto; }
.logo-container { text-align: center; margin: 30px 0; }
.logo-image { max-width: 140px; height: auto; opacity: 0.9; }
.controls { margin: 20px; }
select, button { padding: 10px; font-size: 18px; margin: 5px; border-radius: 8px; }
.team-container { display: flex; flex-direction: column; align-items: center; margin: 20px 0; }
.scoreboard { display: flex; flex-direction: column; align-items: center; margin: 20px auto; max-width: 95%; }
.player { margin: 20px 0; border: 2px solid #555; border-radius: 12px; padding: 10px; width: 100%; background: #333; }
.player h3 { margin-bottom: 10px; }
.frames { display: flex; flex-direction: row; flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; max-width: 95vw; margin: 0 auto; }
.frame { border: 1px solid #777; margin: 2px; padding: 8px; min-width: 55px; background: #444; border-radius: 8px; font-size: 18px; flex: 0 0 auto; }
.inputs { display: flex; justify-content: center; margin-bottom: 5px; }
.inputs input { width: 24px; height: 24px; text-align: center; margin: 0 2px; font-size: 18px; border-radius: 4px; border: none; }
.score { font-size: 20px; font-weight: bold; color: #ffcc00; visibility: hidden; }
.active-frame { outline: 2px solid #ffcc00; border-radius: 8px; }
.frame-label { font-size: 14px; margin-top: 4px; color: #aaa; }
.total-score { font-size: 22px; font-weight: bold; margin-top: 10px; color: #00ffcc; }
.team-total { font-size: 24px; font-weight: bold; margin: 15px; color: #ff6666; }
</style>
</head>
<body>
<div class="title-container">
  <img src="assets/bowling party.jpg" alt="Bowling Party!!!" class="title-image">
</div>

<div class="controls">
  <h2>ðŸŽ³ Team Setup ðŸŽ³</h2>
  <p>Select up to 5 players per team or choose single-player mode.</p>
  <div>
    <label>Single Player Mode:</label>
    <select id="singlePlayerSelect">
      <option value="0">Off</option>
      <option value="1">On</option>
    </select>
  </div>
  <div id="teamSelects">
    <div>
      <label>Team 1 Players:</label>
      <select id="team1Count">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>
    <div>
      <label>Team 2 Players:</label>
      <select id="team2Count">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>
  </div>
  <button onclick="startGame()">Start Game ðŸš€</button>
</div>

<div id="scoreboard" class="scoreboard"></div>

<div class="logo-container">
  <img src="assets/SCG Logo.jpg" alt="SCG Logo" class="logo-image">
</div>

<script>
const archetypes = [
  { name: "Tilly", handicap: 39, average: 166 },
  { name: "Debbie", handicap: 71, average: 121 },
  { name: "Robert", handicap: -59, average: 279 },
  { name: "Samuel", handicap: 19, average: 188 },
  { name: "Peyton", handicap: -27, average: 241 },
  { name: "Amara", handicap: -40, average: 255 },
  { name: "Tito", handicap: 27, average: 180 },
  { name: "Wendy", handicap: -46, average: 262 },
  { name: "David", handicap: 32, average: 174 },
  { name: "Marcus", handicap: 49, average: 156 },
  { name: "Jacob", handicap: 58, average: 145 },
  { name: "Amanda", handicap: 32, average: 164 }
];

function startGame() {
  const isSingle = document.getElementById("singlePlayerSelect").value==="1";
  const scoreboard = document.getElementById("scoreboard");
  scoreboard.innerHTML = "";
  
  if(isSingle){
    buildTeam(scoreboard,"Single Player",1,true);
    document.getElementById("teamSelects").style.display="none";
  } else {
    document.getElementById("teamSelects").style.display="block";
    const team1Count = parseInt(document.getElementById("team1Count").value);
    const team2Count = parseInt(document.getElementById("team2Count").value);
    buildTeam(scoreboard, "Team 1", team1Count);
    buildTeam(scoreboard, "Team 2", team2Count);
    buildTeamTotal(scoreboard); // placeholder for total scores
  }
}

function buildTeam(scoreboard, teamName, playerCount, single=false) {
  const teamContainer = document.createElement("div");
  teamContainer.className = "team-container";
  const teamTitle = document.createElement("h2");
  teamTitle.textContent = `ðŸ”¥ ${teamName} ðŸ”¥`;
  teamContainer.appendChild(teamTitle);

  for(let i=0;i<playerCount;i++){
    const player = document.createElement("div");
    player.className="player";

    const playerName = document.createElement("h3");
    const select = document.createElement("select");
    archetypes.forEach(arc=>{
      const option = document.createElement("option");
      option.value=arc.name;
      option.textContent=`${arc.name} (Avg:${arc.average}, HCP:${arc.handicap})`;
      select.appendChild(option);
    });
    playerName.appendChild(select);
    player.appendChild(playerName);

    const frames = document.createElement("div");
    frames.className="frames";

    player.frames=[];

    for(let f=1;f<=10;f++){
      const frame = document.createElement("div");
      frame.className="frame";
      frame.dataset.index=f-1;

      const inputs = document.createElement("div");
      inputs.className="inputs";

      const input1 = document.createElement("input");
      const input2 = document.createElement("input");
      input1.maxLength=1; input2.maxLength=1;
      inputs.appendChild(input1); inputs.appendChild(input2);

      if(f===10){
        const input3 = document.createElement("input");
        input3.maxLength=1;
        inputs.appendChild(input3);
        frame.input3=input3;
      }

      frame.appendChild(inputs);

      const score = document.createElement("div");
      score.className="score";
      score.textContent="0";
      frame.appendChild(score);

      const label = document.createElement("div");
      label.className="frame-label";
      label.textContent=`Frame ${f}`;
      frame.appendChild(label);

      // store inputs in player.frames
      frame.input1=input1; frame.input2=input2;
      player.frames.push(frame);

      // add input event listeners
      [input1,input2,frame.input3].forEach(inp=>{
        if(inp){
          inp.addEventListener("input",()=>{
            // auto-tab to next input
            if(inp.value.toUpperCase()==="X" || inp.value==="/" || inp.value==="-"){
              moveToNextInput(player,f-1,inp);
            }
            updateScores(player);
          });
        }
      });

      frames.appendChild(frame);
    }

    player.appendChild(frames);
    teamContainer.appendChild(player);
  }

  scoreboard.appendChild(teamContainer);
}

function moveToNextInput(player, frameIndex, currentInput){
  const frame=player.frames[frameIndex];
  if(currentInput===frame.input1 && frame.input2){
    frame.input2.focus();
  } else if(currentInput===frame.input2){
    if(frame.input3) frame.input3.focus();
    else{
      // move to next frame's first input
      if(player.frames[frameIndex+1]) player.frames[frameIndex+1].input1.focus();
    }
  } else if(currentInput===frame.input3){
    if(player.frames[frameIndex+1]) player.frames[frameIndex+1].input1.focus();
  }
}

function updateScores(player){
  const frameScores = calculateFrameScores(player);
  let runningTotal=0;
  for(let f=0;f<player.frames.length;f++){
    const scoreDiv = player.frames[f].querySelector(".score");
    if(frameScores[f]!==undefined){
      scoreDiv.style.visibility="visible";
      runningTotal+=frameScores[f];
      scoreDiv.textContent=runningTotal;
    }
  }
}

function calculateFrameScores(player) {
  const rolls=[];
  player.frames.forEach(f=>{
    [f.input1,f.input2,f.input3].forEach(inp=>{
      if(inp && inp.value!=="") rolls.push(inp.value.toUpperCase());
    });
  });

  const frameScores=[];
  let rollIndex=0;

  for(let f=0;f<10;f++){
    if(rollIndex>=rolls.length) break;
    let first=rolls[rollIndex];
    let second=rolls[rollIndex+1];
    let third=rolls[rollIndex+2];

    const firstVal=convertRoll(first);
    let secondVal=0;

    if(second==="/"){
      secondVal=10-firstVal;
    } else {
      secondVal=convertRoll(second);
    }

    const thirdVal=convertRoll(third);

    let frameScore=0;

    if(f<9){
      if(first==="X"){
        const bonus1=nextValidRoll(rolls,rollIndex+1);
        const bonus2=nextValidRoll(rolls,rollIndex+2);
        frameScore=10+bonus1+bonus2;
        rollIndex+=1;
      } else if(second==="/"){
        const bonus=nextValidRoll(rolls,rollIndex+2);
        frameScore=10+bonus;
        rollIndex+=2;
      } else {
        frameScore=firstVal+secondVal;
        rollIndex+=2;
      }
    } else {
      frameScore=firstVal+secondVal+thirdVal;
      rollIndex+=(third?3:2);
    }

    frameScores.push(frameScore);
  }

  return frameScores;
}

function nextValidRoll(rolls,start){
  for(let i=start;i<rolls.length;i++){
    const val=rolls[i];
    if(val && val!==""){
      if(val==="X") return 10;
      if(val==="/") return 10;
      if(val==="-") return 0;
      if(!isNaN(val)) return parseInt(val);
    }
  }
  return 0;
}

function convertRoll(val){
  if(!val) return 0;
  if(val==="X") return 10;
  if(val==="-") return 0;
  if(!isNaN(val)) return parseInt(val);
  return 0;
}

// optional: team total display placeholder
function buildTeamTotal(scoreboard){
  const totals = document.createElement("div");
  totals.className="team-total";
  totals.textContent="Team totals will be calculated here";
  scoreboard.appendChild(totals);
}
</script>
</body>
</html>
