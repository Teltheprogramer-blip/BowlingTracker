<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bowling Party!!! (Web-App Companion)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin: 20px;
      font-size: 2em;
    }
    .setup, .game {
      margin: 20px auto;
      max-width: 95%;
    }
    select, input[type="number"] {
      font-size: 1.2em;
      padding: 8px;
      margin: 8px;
      width: 260px;
      text-align: center;
    }
    button {
      padding: 12px 20px;
      margin: 20px;
      font-size: 1.2em;
      border-radius: 10px;
      border: none;
      background: #28a745;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #218838;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px auto;
    }
    th, td {
      border: 1px solid #555;
      padding: 10px;
      text-align: center;
      font-size: 1.1em;
    }
    th {
      background: #222;
    }
    input.frameInput {
      width: 40px;
      font-size: 1.1em;
      text-align: center;
    }
    .final-scores {
      margin-top: 30px;
      font-size: 1.3em;
    }
  </style>
</head>
<body>
  <h1>Bowling Party!!! (Web-App Companion)</h1>
  
  <div class="setup">
    <label for="playerCount">Select Number of Players (1‚Äì10): </label>
    <input type="number" id="playerCount" min="1" max="10" value="2"/>
    <button onclick="createPlayerSelectors()">Set Players</button>
    <div id="playerSelectors"></div>
    <button id="startBtn" style="display:none;" onclick="startGame()">Start Game</button>
  </div>

  <div class="game" id="game" style="display:none;"></div>

  <script>
    const archetypes = [
      { name: "Tilly", handicap: 39, average: 166 },
      { name: "Debbie", handicap: 71, average: 121 },
      { name: "Robert", handicap: -59, average: 279 },
      { name: "Samuel", handicap: 19, average: 188 },
      { name: "Peyton", handicap: -27, average: 241 },
      { name: "Amara", handicap: -40, average: 255 },
      { name: "Tito", handicap: 27, average: 180 },
      { name: "Wendy", handicap: -46, average: 262 },
      { name: "David", handicap: 32, average: 174 },
      { name: "Marcus", handicap: 49, average: 156 },
      { name: "Jacob", handicap: 58, average: 145 },
      { name: "Amanda", handicap: 32, average: 164 }
    ];

    let players = [];

    function createPlayerSelectors() {
      const count = parseInt(document.getElementById("playerCount").value);
      if (count < 1 || count > 10) {
        alert("Players must be between 1 and 10");
        return;
      }
      const container = document.getElementById("playerSelectors");
      container.innerHTML = "";
      for (let i = 0; i < count; i++) {
        const select = document.createElement("select");
        select.id = "playerSelect" + i;
        archetypes.forEach(a => {
          const option = document.createElement("option");
          option.value = a.name;
          option.textContent = `${a.name} (Avg: ${a.average}, Hcp: ${a.handicap})`;
          select.appendChild(option);
        });
        container.appendChild(select);
        container.appendChild(document.createElement("br"));
      }
      document.getElementById("startBtn").style.display = "inline-block";
    }

    function startGame() {
      const count = parseInt(document.getElementById("playerCount").value);
      players = [];
      for (let i = 0; i < count; i++) {
        const name = document.getElementById("playerSelect" + i).value;
        const archetype = archetypes.find(a => a.name === name);
        players.push({
          name: archetype.name,
          average: archetype.average,
          handicap: archetype.handicap,
          frames: Array(10).fill(null).map(() => []),
          scores: Array(10).fill(null)
        });
      }
      renderGame();
    }

    function renderGame() {
      const container = document.getElementById("game");
      container.style.display = "block";
      let html = "<table><tr><th>Player</th>";
      for (let i = 1; i <= 10; i++) {
        html += `<th>Frame ${i}</th>`;
      }
      html += "<th>Total</th></tr>";

      players.forEach((p, idx) => {
        html += `<tr><td>${p.name}</td>`;
        for (let f = 0; f < 10; f++) {
          html += `<td id="p${idx}f${f}">`;
          let maxInputs = (f === 9) ? 3 : 2;
          for (let k = 0; k < maxInputs; k++) {
            html += `<input class="frameInput" maxlength="1" oninput="updateFrame(${idx}, ${f})"/>`;
          }
          html += `<div class="frameScore" id="p${idx}f${f}score"></div></td>`;
        }
        html += `<td id="p${idx}total"></td></tr>`;
      });

      html += "</table>";
      html += `<button onclick="calculateWinner()">Calculate Winner</button>`;
      html += `<div class="final-scores" id="finalScores"></div>`;
      container.innerHTML = html;
    }

    function parseInput(val) {
      if (val === "X") return 10;
      if (val === "/") return "/";
      if (val === "-") return 0;
      let num = parseInt(val);
      return isNaN(num) ? null : num;
    }

    function updateFrame(pIdx, fIdx) {
      const player = players[pIdx];
      const frameDiv = document.getElementById(`p${pIdx}f${fIdx}score`);
      const frameInputs = document.querySelectorAll(`#p${pIdx}f${fIdx} input`);
      let rolls = [];
      frameInputs.forEach(inp => {
        rolls.push(parseInput(inp.value));
      });
      if (rolls.some(r => r === null)) {
        frameDiv.innerText = "";
        return;
      }
      player.frames[fIdx] = rolls;
      calculateScores(pIdx);
    }

    function calculateScores(pIdx) {
      const player = players[pIdx];
      let total = 0;
      for (let f = 0; f < 10; f++) {
        let frame = player.frames[f];
        if (frame.includes(null) || frame.length === 0) {
          document.getElementById(`p${pIdx}f${f}score`).innerText = "";
          continue;
        }
        let frameScore = 0;
        if (f < 9) {
          if (frame[0] === 10) {
            frameScore = 10;
          } else if (frame[1] === "/") {
            frameScore = 10;
          } else {
            frameScore = (frame[0] || 0) + (frame[1] || 0);
          }
        } else {
          frameScore = frame.reduce((a, b) => a + (b === "/" ? 10 : b || 0), 0);
        }
        total += frameScore;
        document.getElementById(`p${pIdx}f${f}score`).innerText = total;
      }
      document.getElementById(`p${pIdx}total`).innerText = total + player.handicap;
      player.total = total + player.handicap;
    }

    function calculateWinner() {
      let team1 = players.slice(0, 5).reduce((a, b) => a + (b.total || 0), 0);
      let team2 = players.slice(5, 10).reduce((a, b) => a + (b.total || 0), 0);
      let result = `<p>Team 1: ${team1}</p><p>Team 2: ${team2}</p>`;
      if (team1 > team2) result += "<p>üèÜ Team 1 Wins!</p>";
      else if (team2 > team1) result += "<p>üèÜ Team 2 Wins!</p>";
      else result += "<p>It's a Tie!</p>";
      document.getElementById("finalScores").innerHTML = result;
    }
  </script>
</body>
</html>
