<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bowling Party!!! (Web-App Companion)</title>
<style>
  body { font-family: Arial; text-align: center; background: #222; color: #fff; margin:0; padding:0; }
  .title-container { margin-top: 20px; }
  .title-image { max-width: 90%; height: auto; }
  .logo-container { text-align: center; margin: 30px 0; }
  .logo-image { max-width: 140px; height:auto; opacity:0.9; }
  .controls { margin: 20px; }
  select, button { padding:10px; font-size:18px; margin:5px; border-radius:8px; }
  .team-container { display:flex; flex-direction:column; align-items:center; margin:20px 0; }
  .scoreboard { display:flex; flex-direction:column; align-items:center; margin:20px auto; max-width:95%; }
  .player { margin:20px 0; border:2px solid #555; border-radius:12px; padding:10px; width:100%; background:#333; position:relative; }
  .player h3 { margin-bottom:10px; }
  .frames { display:flex; flex-direction:row; flex-wrap:nowrap; overflow-x:auto; -webkit-overflow-scrolling:touch; max-width:95vw; margin:0 auto; }
  .frame { border:1px solid #777; margin:2px; padding:8px; min-width:55px; background:#444; border-radius:8px; font-size:18px; flex:0 0 auto; position:relative; }
  .inputs { display:flex; justify-content:center; margin-bottom:5px; }
  .inputs input { width:24px; height:24px; text-align:center; margin:0 2px; font-size:18px; border-radius:4px; border:none; background:#222; color:#fff; }
  .inputs input.active-roll { border:2px solid #00ffff; background:#000; }
  .score { font-size:20px; font-weight:bold; color:#ffcc00; visibility:hidden; }
  .score.strike { color: gold; }
  .score.spare { color: cyan; }
  .totals { margin-top:10px; font-size:20px; font-weight:bold; color:#00ffcc; }
  .active-frame { box-shadow:0 0 10px 2px #00ffff; }
  .active-indicator { position:absolute; left:-25px; top:8px; font-size:18px; }
  .frame-label { font-size:12px; color:#ccc; margin-top:2px; }
</style>
</head>
<body>

<div class="title-container">
  <img src="assets/bowling party.jpg" alt="Bowling Party!!!" class="title-image">
</div>

<div class="controls">
  <h2>ðŸŽ³ Mode Select ðŸŽ³</h2>
  <button onclick="startSinglePlayer()">Single Player ðŸŽ¯</button>
  <button onclick="startTeamMode()">Team Mode ðŸ‘«</button>
</div>

<div id="scoreboard" class="scoreboard"></div>

<div class="logo-container">
  <img src="assets/SCG Logo.jpg" alt="SCG Logo" class="logo-image">
</div>

<script>
const archetypes = [
  { name: "Tilly", handicap: 39, average: 166 },
  { name: "Debbie", handicap: 71, average: 121 },
  { name: "Robert", handicap: -59, average: 279 },
  { name: "Samuel", handicap: 19, average: 188 },
  { name: "Peyton", handicap: -27, average: 241 },
  { name: "Amara", handicap: -40, average: 255 },
  { name: "Tito", handicap: 27, average: 180 },
  { name: "Wendy", handicap: -46, average: 262 },
  { name: "David", handicap: 32, average: 174 },
  { name: "Marcus", handicap: 49, average: 156 },
  { name: "Jacob", handicap: 58, average: 145 },
  { name: "Amanda", handicap: 32, average: 164 }
];

let allPlayers = [];

function startSinglePlayer() {
  const scoreboard = document.getElementById("scoreboard");
  scoreboard.innerHTML = "";
  allPlayers = [];
  const player = buildPlayer(scoreboard, "Player 1");
  allPlayers.push(player);
}

function startTeamMode() {
  const scoreboard = document.getElementById("scoreboard");
  scoreboard.innerHTML = "";
  allPlayers = [];
  const team1Count = parseInt(prompt("Enter number of players for Team 1 (1-5):", "3"));
  const team2Count = parseInt(prompt("Enter number of players for Team 2 (1-5):", "3"));
  const team1Container = buildTeam(scoreboard, "Team 1", team1Count);
  const team2Container = buildTeam(scoreboard, "Team 2", team2Count);

  [team1Container, team2Container].forEach(teamContainer => {
    const teamTotalDiv = document.createElement("div");
    teamTotalDiv.className = "totals";
    teamTotalDiv.textContent = "Team Total: 0";
    teamContainer.appendChild(teamTotalDiv);
    teamContainer.teamTotalDiv = teamTotalDiv;
  });
}

function buildTeam(container, teamName, playerCount) {
  const teamContainer = document.createElement("div");
  teamContainer.className = "team-container";
  const teamTitle = document.createElement("h2");
  teamTitle.textContent = `ðŸ”¥ ${teamName} ðŸ”¥`;
  teamContainer.appendChild(teamTitle);

  for (let i = 0; i < playerCount; i++) {
    const player = buildPlayer(teamContainer, `${teamName} - Player ${i + 1}`);
    allPlayers.push(player);
  }

  container.appendChild(teamContainer);
  return teamContainer;
}

function buildPlayer(container, label) {
  const player = document.createElement("div");
  player.className = "player";

  const playerName = document.createElement("h3");
  playerName.textContent = label;
  player.appendChild(playerName);

  const select = document.createElement("select");
  archetypes.forEach(arc => {
    const option = document.createElement("option");
    option.value = JSON.stringify(arc);
    option.textContent = `${arc.name} (Avg: ${arc.average}, HCP: ${arc.handicap})`;
    select.appendChild(option);
  });
  player.appendChild(select);

  const frames = document.createElement("div");
  frames.className = "frames";
  player.frames = [];

  for (let f = 0; f < 10; f++) {
    const frame = document.createElement("div");
    frame.className = "frame";

    const activeIndicator = document.createElement("div");
    activeIndicator.className = "active-indicator";
    frame.appendChild(activeIndicator);

    const inputs = document.createElement("div");
    inputs.className = "inputs";

    const input1 = document.createElement("input");
    const input2 = document.createElement("input");
    input1.maxLength = 1; input2.maxLength = 1;
    inputs.appendChild(input1); inputs.appendChild(input2);

    if (f === 9) {
      const input3 = document.createElement("input");
      input3.maxLength = 1;
      inputs.appendChild(input3);
      frame.input3 = input3;
    }

    frame.input1 = input1; frame.input2 = input2;
    frame.appendChild(inputs);

    const score = document.createElement("div");
    score.className = "score";
    score.textContent = "0";
    frame.appendChild(score);

    const labelDiv = document.createElement("div");
    labelDiv.className = "frame-label";
    labelDiv.textContent = `Frame ${f+1}`;
    frame.appendChild(labelDiv);

    frames.appendChild(frame);
    player.frames.push(frame);

    [input1, input2, frame.input3].forEach((inp, idx) => {
      if(!inp) return;
      inp.addEventListener("input", () => {
        if (["X","/","-"].includes(inp.value.toUpperCase()) || !isNaN(inp.value)) {
          setActiveRoll(inp, frame);
          handleFrameInput(player);
          // Auto-tab & skip strike
          const r1 = frame.input1.value.toUpperCase();
          if(inp===frame.input1 && r1==="X" && frame.input3===undefined){
            const nextFrame = player.frames[player.frames.indexOf(frame)+1];
            if(nextFrame) nextFrame.input1.focus();
          } else autoTabWithinFrame(frame, inp===frame.input1?0:1);
        }
      });
      inp.addEventListener("focus",()=>setActiveFrame(player,f));
    });
  }

  player.appendChild(frames);

  const totals = document.createElement("div");
  totals.className = "totals";
  totals.textContent = "Raw Total: 0 | Final Total: 0";
  player.appendChild(totals);

  container.appendChild(player);
  return player;
}

function setActiveRoll(input, frame){
  frame.querySelectorAll("input").forEach(i=>i.classList.remove("active-roll"));
  if(input) input.classList.add("active-roll");
}

function handleFrameInput(player){
  const rolls = [];
  player.frames.forEach(frame=>{
    const r1=frame.input1.value.toUpperCase();
    const r2=frame.input2.value.toUpperCase();
    const r3=(frame.input3)? frame.input3.value.toUpperCase() : null;
    if(r1) rolls.push(r1); if(r2) rolls.push(r2); if(r3) rolls.push(r3);
  });

  const frameScores = [];
  let rollIndex=0;
  for(let f=0; f<10; f++){
    if(rollIndex>=rolls.length) break;
    let first=rolls[rollIndex], second=rolls[rollIndex+1], third=rolls[rollIndex+2];
    let firstVal=convertRoll(first), secondVal=convertRoll(second), thirdVal=convertRoll(third);
    let frameScore=0;

    if(f<9){
      if(first==="X"){ 
        frameScore = 10 + convertRoll(rolls[rollIndex+1]) + convertRoll(rolls[rollIndex+2]); 
        rollIndex += 1; 
      } else if(second==="/"){ 
        frameScore = 10; // âœ… Spare now counts as exactly 10 for the frame
        rollIndex += 2; 
      } else { 
        frameScore = firstVal + secondVal; 
        rollIndex += 2; 
      }
    } else { 
      frameScore = firstVal + secondVal + thirdVal; 
      rollIndex += (third?3:2); 
    }

    frameScores.push(frameScore);
  }

  let cumScore=0;
  player.frames.forEach((frame,i)=>{
    if(frameScores[i]!==undefined){
      cumScore+=frameScores[i];
      const scoreDiv=frame.querySelector(".score");
      scoreDiv.textContent=cumScore;
      scoreDiv.style.visibility="visible";

      const r1=frame.input1.value.toUpperCase();
      const r2=frame.input2.value.toUpperCase();
      scoreDiv.classList.remove("strike","spare");
      if(r1==="X") scoreDiv.classList.add("strike");
      else if(r2==="/") scoreDiv.classList.add("spare");
    }
  });

  const arc = JSON.parse(player.querySelector("select").value);
  const totalRaw = frameScores.reduce((a,b)=>a+b,0);
  player.querySelector(".totals").textContent=`Raw Total: ${totalRaw} | Final Total: ${totalRaw+arc.handicap}`;

  // Update team total if in team mode
  const teamContainer = player.parentNode.classList.contains("team-container") ? player.parentNode : player.parentNode.parentNode;
  if(teamContainer && teamContainer.teamTotalDiv){
    let teamTotal = 0;
    teamContainer.querySelectorAll(".player").forEach(p=>{
      const arc = JSON.parse(p.querySelector("select").value);
      const rawTotal = p.querySelector(".totals").textContent.match(/Raw Total: (\d+)/);
      if(rawTotal) teamTotal += parseInt(rawTotal[1]) + arc.handicap;
    });
    teamContainer.teamTotalDiv.textContent = `Team Total: ${teamTotal}`;
  }
}

function convertRoll(val){
  if(!val) return 0;
  if(val==="X") return 10;
  if(val==="/") return 0; // spare is handled separately in frame logic
  if(val==="-") return 0;
  if(!isNaN(val)) return parseInt(val);
  return 0;
}

function autoTabWithinFrame(frame,inputIndex){
  let nextInput;
  if(inputIndex===0) nextInput=frame.input2;
  else if(inputIndex===1 && frame.input3) nextInput=frame.input3;
  if(nextInput) nextInput.focus();
}

function setActiveFrame(player,frameIndex){
  allPlayers.forEach(p=>p.frames.forEach(f=>{ f.classList.remove("active-frame"); f.querySelector(".active-indicator").textContent=""; }));
  const activeFrame=player.frames[frameIndex];
  activeFrame.classList.add("active-frame");
  activeFrame.querySelector(".active-indicator").textContent="ðŸŽ³";
}
</script>
</body>
</html>
