<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bowling Party!!! (Web-App Companion)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #222;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    .title-container {
      margin-top: 20px;
    }

    .title-image {
      max-width: 90%;
      height: auto;
    }

    .logo-container {
      text-align: center;
      margin: 30px 0;
    }

    .logo-image {
      max-width: 140px;
      height: auto;
      opacity: 0.9;
    }

    .controls {
      margin: 20px;
    }

    select, button {
      padding: 10px;
      font-size: 18px;
      margin: 5px;
      border-radius: 8px;
    }

    .team-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }

    .scoreboard {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px auto;
      max-width: 95%;
    }

    .player {
      margin: 20px 0;
      border: 2px solid #555;
      border-radius: 12px;
      padding: 10px;
      width: 100%;
      background: #333;
    }

    .player h3 {
      margin-bottom: 10px;
    }

    .active-frame-indicator {
      font-size: 16px;
      margin-bottom: 5px;
      color: #ffcc00;
    }

    .frames {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      max-width: 95vw;
      margin: 0 auto;
    }

    .frame {
      border: 2px solid #777;
      margin: 2px;
      padding: 8px;
      min-width: 55px;
      background: #444;
      border-radius: 8px;
      font-size: 18px;
      flex: 0 0 auto;
      position: relative;
    }

    .frame.active {
      border-color: gold;
    }

    .inputs {
      display: flex;
      justify-content: center;
      margin-bottom: 5px;
    }

    .inputs input {
      width: 28px;
      height: 28px;
      text-align: center;
      margin: 0 2px;
      font-size: 18px;
      border-radius: 4px;
      border: none;
    }

    .score {
      font-size: 18px;
      font-weight: bold;
      color: #ffcc00;
      visibility: hidden;
    }

    .frame-label {
      font-size: 14px;
      color: #ccc;
      margin-top: 2px;
    }

    .team-total {
      font-size: 20px;
      margin-top: 10px;
      font-weight: bold;
      color: #ff6666;
    }
  </style>
</head>
<body>

  <!-- Title Image -->
  <div class="title-container">
    <img src="assets/bowling party.jpg" alt="Bowling Party!!!" class="title-image">
  </div>

  <div class="controls">
    <h2>ðŸŽ³ Select Mode ðŸŽ³</h2>
    <button onclick="startSinglePlayer()">Single Player</button>
    <button onclick="startTeam()">Team Mode</button>
  </div>

  <div id="scoreboard" class="scoreboard"></div>

  <!-- Bottom Logo -->
  <div class="logo-container">
    <img src="assets/SCG Logo.jpg" alt="SCG Logo" class="logo-image">
  </div>

  <script>
    const archetypes = [
      { name: "Tilly", handicap: 39, average: 166 },
      { name: "Debbie", handicap: 71, average: 121 },
      { name: "Robert", handicap: -59, average: 279 },
      { name: "Samuel", handicap: 19, average: 188 },
      { name: "Peyton", handicap: -27, average: 241 },
      { name: "Amara", handicap: -40, average: 255 },
      { name: "Tito", handicap: 27, average: 180 },
      { name: "Wendy", handicap: -46, average: 262 },
      { name: "David", handicap: 32, average: 174 },
      { name: "Marcus", handicap: 49, average: 156 },
      { name: "Jacob", handicap: 58, average: 145 },
      { name: "Amanda", handicap: 32, average: 164 }
    ];

    let activePlayer=null;

    function startSinglePlayer(){
      const scoreboard = document.getElementById("scoreboard");
      scoreboard.innerHTML = "";
      buildPlayer(scoreboard, "Player 1");
    }

    function startTeam(){
      const scoreboard = document.getElementById("scoreboard");
      scoreboard.innerHTML = "";
      const team1Count = Math.min(prompt("Enter number of players for Team 1 (1-5)", "2") || 2,5);
      const team2Count = Math.min(prompt("Enter number of players for Team 2 (1-5)", "2") || 2,5);

      buildTeam(scoreboard, "Team 1", team1Count);
      buildTeam(scoreboard, "Team 2", team2Count);
    }

    function buildTeam(scoreboard, teamName, playerCount){
      const teamContainer=document.createElement("div");
      teamContainer.className="team-container";

      const teamTitle=document.createElement("h2");
      teamTitle.textContent=`ðŸ”¥ ${teamName} ðŸ”¥`;
      teamContainer.appendChild(teamTitle);

      for(let i=0;i<playerCount;i++){
        buildPlayer(teamContainer, `${teamName} Player ${i+1}`);
      }

      scoreboard.appendChild(teamContainer);
    }

    function buildPlayer(container, playerName){
      const player=document.createElement("div");
      player.className="player";
      player.frames=[];

      const header=document.createElement("h3");
      const select=document.createElement("select");
      archetypes.forEach(a=>{
        const option=document.createElement("option");
        option.value=a.name;
        option.textContent=`${a.name} (Avg:${a.average}, HCP:${a.handicap})`;
        select.appendChild(option);
      });
      header.appendChild(select);
      player.appendChild(header);

      // Active Frame Indicator
      const activeFrameIndicator=document.createElement("div");
      activeFrameIndicator.className="active-frame-indicator";
      activeFrameIndicator.textContent="Active Frame: 1";
      player.appendChild(activeFrameIndicator);

      const framesDiv=document.createElement("div");
      framesDiv.className="frames";

      for(let f=1;f<=10;f++){
        const frame=document.createElement("div");
        frame.className="frame";

        const inputsDiv=document.createElement("div");
        inputsDiv.className="inputs";

        const input1=document.createElement("input");
        const input2=document.createElement("input");
        input1.maxLength=1;
        input2.maxLength=1;
        inputsDiv.appendChild(input1);
        inputsDiv.appendChild(input2);

        if(f===10){
          const input3=document.createElement("input");
          input3.maxLength=1;
          inputsDiv.appendChild(input3);
        }

        frame.appendChild(inputsDiv);

        const scoreDiv=document.createElement("div");
        scoreDiv.className="score";
        scoreDiv.textContent="0";
        frame.appendChild(scoreDiv);

        const label=document.createElement("div");
        label.className="frame-label";
        label.textContent=`Frame ${f}`;
        frame.appendChild(label);

        player.frames.push({frame, input1, input2, input3: f===10?inputsDiv.querySelectorAll("input")[2]:null, score:scoreDiv});
        framesDiv.appendChild(frame);

        [input1,input2,input3].forEach(inp=>{
          if(inp){
            inp.addEventListener("input",()=>handleInput(player, frame, inp));
          }
        });
      }

      player.appendChild(framesDiv);
      container.appendChild(player);
    }

    function handleInput(player, frame, inp){
      activePlayer = player;
      const frameIndex = player.frames.findIndex(f=>f.frame===frame);
      const indicator = player.querySelector(".active-frame-indicator");
      indicator.textContent = `Active Frame: ${frameIndex+1}`;

      const val = inp.value.toUpperCase();
      inp.value = val;

      if(val==='X' && inp===player.frames[frameIndex].input1 && inp!==player.frames[9].input1){
        const nextFrame = getNextFrame(player, frame);
        if(nextFrame) nextFrame.input1.focus();
      } else {
        autoTab(player, frame, inp);
      }

      calculateAndDisplayScores(player);
      updateTeamTotals();
    }

    function autoTab(player, frame, inp){
      const fObj = player.frames.find(f=>f.frame===frame);
      if(inp===fObj.input1 && fObj.input2) fObj.input2.focus();
      else if(inp===fObj.input2 && fObj.input3) fObj.input3.focus();
    }

    function getNextFrame(player, frame){
      const idx = player.frames.findIndex(f=>f.frame===frame);
      return player.frames[idx+1];
    }

    function convertRoll(val){
      if(val==='-' || !val) return 0;
      if(!isNaN(val)) return parseInt(val);
      if(val.toUpperCase()==='X') return 10;
      return 0;
    }

    function calculateAndDisplayScores(player){
      const rolls=[];
      player.frames.forEach(f=>{
        [f.input1,f.input2,f.input3].forEach(inp=>{
          if(inp && inp.value!=='') rolls.push(inp.value.toUpperCase());
        });
      });

      let runningTotal=0;
      let rollIndex=0;

      player.frames.forEach((f,idx)=>{
        const first=rolls[rollIndex];
        const second=rolls[rollIndex+1];
        const third=rolls[rollIndex+2];
        const firstVal=convertRoll(first);
        let secondVal=0;
        if(second==='/') secondVal=10-firstVal;
        else secondVal=convertRoll(second);
        const thirdVal=convertRoll(third);

        let frameScore=null;

        if(idx<9){
          if(first==='X'){
            const bonus1=nextValidRoll(rolls,rollIndex+1);
            const bonus2=nextValidRoll(rolls,rollIndex+2);
            frameScore=10+bonus1+bonus2;
            rollIndex+=1;
          } else if(second==='/'){
            const bonus=nextValidRoll(rolls,rollIndex+2);
            frameScore=10+bonus;
            rollIndex+=2;
          } else if(first && second){
            frameScore=firstVal+secondVal;
            rollIndex+=2;
          } else {
            frameScore=null;
          }
        } else {
          frameScore=firstVal+secondVal+(third?thirdVal:0);
          rollIndex+= (f.input3 && f.input3.value?3:2);
        }

        if(frameScore!==null){
          runningTotal+=frameScore;
          f.score.style.visibility="visible";
          f.score.textContent=runningTotal;
        } else f.score.style.visibility="hidden";
      });
    }

    function nextValidRoll(rolls,start){
      for(let i=start;i<rolls.length;i++){
        if(rolls[i]!=='') return convertRoll(rolls[i]);
      }
      return 0;
    }

    function updateTeamTotals(){
      document.querySelectorAll(".team-container").forEach(team=>{
        let teamTotal=0;
        team.querySelectorAll(".player").forEach(player=>{
          const frames=player.frames;
          frames.forEach(f=>{
            if(f.score.style.visibility!=='hidden'){
              teamTotal=parseInt(f.score.textContent);
            }
          });
        });

        let totalDiv=team.querySelector(".team-total");
        if(!totalDiv){
          totalDiv=document.createElement("div");
          totalDiv.className="team-total";
          team.appendChild(totalDiv);
        }
        totalDiv.textContent=`Team Total: ${teamTotal}`;
      });
    }

  </script>
</body>
</html>
