<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bowling Party!!! (Web-App Companion)</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; background: #222; color: #fff; margin: 0; padding: 0; }
.title-container { margin-top: 20px; }
.title-image { max-width: 90%; height: auto; }
.logo-container { text-align: center; margin: 30px 0; }
.logo-image { max-width: 140px; height: auto; opacity: 0.9; }
.controls { margin: 20px; }
select, button { padding: 10px; font-size: 18px; margin: 5px; border-radius: 8px; }
.team-container { display: flex; flex-direction: column; align-items: center; margin: 20px 0; }
.scoreboard { display: flex; flex-direction: column; align-items: center; margin: 20px auto; max-width: 95%; }
.player { margin: 20px 0; border: 2px solid #555; border-radius: 12px; padding: 10px; width: 100%; background: #333; }
.player h3 { margin-bottom: 10px; }
.frames { display: flex; flex-direction: row; justify-content: flex-start; flex-wrap: nowrap; overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; max-width: 95vw; margin: 0 auto; }
.frame { border: 1px solid #777; margin: 2px; padding: 8px; min-width: 55px; background: #444; border-radius: 8px; font-size: 18px; flex: 0 0 auto; position: relative; }
.inputs { display: flex; justify-content: center; margin-bottom: 5px; }
.inputs input { width: 24px; height: 24px; text-align: center; margin: 0 2px; font-size: 18px; border-radius: 4px; border: none; background: #fff; color: #000; }
.score { font-size: 16px; font-weight: bold; color: #ffcc00; }
.frame-label { position: absolute; bottom: -20px; width: 100%; font-size: 14px; color: #aaa; }
.active-frame { border: 2px solid #ffcc00; }
.team-total { font-size: 22px; font-weight: bold; margin-top: 10px; color: #0f0; }
</style>
</head>
<body>

<div class="title-container">
  <img src="assets/bowling party.jpg" alt="Bowling Party!!!" class="title-image">
</div>

<div class="controls">
  <h2>üé≥ Mode Selection üé≥</h2>
  <button onclick="startSinglePlayer()">Single Player üïπÔ∏è</button>
  <button onclick="startTeamGame()">Team Mode üë•</button>
</div>

<div id="scoreboard" class="scoreboard"></div>

<div class="logo-container">
  <img src="assets/SCG Logo.jpg" alt="SCG Logo" class="logo-image">
</div>

<script>
const archetypes=[
  {name:"Tilly", handicap:39, average:166},
  {name:"Debbie", handicap:71, average:121},
  {name:"Robert", handicap:-59, average:279},
  {name:"Samuel", handicap:19, average:188},
  {name:"Peyton", handicap:-27, average:241},
  {name:"Amara", handicap:-40, average:255},
  {name:"Tito", handicap:27, average:180},
  {name:"Wendy", handicap:-46, average:262},
  {name:"David", handicap:32, average:174},
  {name:"Marcus", handicap:49, average:156},
  {name:"Jacob", handicap:58, average:145},
  {name:"Amanda", handicap:32, average:164}
];

function startSinglePlayer(){
  const scoreboard=document.getElementById("scoreboard");
  scoreboard.innerHTML="";
  buildTeam(scoreboard,"Player",1,true);
}

function startTeamGame(){
  let team1Count=parseInt(prompt("How many players on Team 1? (1-5)","2"));
  let team2Count=parseInt(prompt("How many players on Team 2? (1-5)","2"));
  if(isNaN(team1Count) || team1Count<1) team1Count=1;
  if(team1Count>5) team1Count=5;
  if(isNaN(team2Count) || team2Count<1) team2Count=1;
  if(team2Count>5) team2Count=5;
  const scoreboard=document.getElementById("scoreboard");
  scoreboard.innerHTML="";
  buildTeam(scoreboard,"Team 1",team1Count);
  buildTeam(scoreboard,"Team 2",team2Count);
  buildTeamTotal(scoreboard);
}

function buildTeam(scoreboard,teamName,playerCount,single=false){
  const teamContainer=document.createElement("div");
  teamContainer.className="team-container";
  const teamTitle=document.createElement("h2");
  teamTitle.textContent=`üî• ${teamName} üî•`;
  teamContainer.appendChild(teamTitle);

  for(let i=0;i<playerCount;i++){
    const player=document.createElement("div");
    player.className="player";
    player.frames=[];

    const playerName=document.createElement("h3");
    const select=document.createElement("select");
    archetypes.forEach(arc=>{
      const option=document.createElement("option");
      option.value=arc.name;
      option.textContent=`${arc.name} (Avg:${arc.average}, HCP:${arc.handicap})`;
      select.appendChild(option);
    });
    playerName.appendChild(select);
    player.appendChild(playerName);

    const frames=document.createElement("div");
    frames.className="frames";

    for(let f=1;f<=10;f++){
      const frame=document.createElement("div");
      frame.className="frame";

      const inputs=document.createElement("div");
      inputs.className="inputs";

      const input1=document.createElement("input");
      const input2=document.createElement("input");
      input1.maxLength=1; input2.maxLength=1;
      frame.input1=input1; frame.input2=input2;
      inputs.appendChild(input1); inputs.appendChild(input2);

      if(f===10){
        const input3=document.createElement("input");
        input3.maxLength=1;
        frame.input3=input3;
        inputs.appendChild(input3);
      } else frame.input3=null;

      frame.appendChild(inputs);

      const score=document.createElement("div");
      score.className="score";
      score.textContent="0";
      frame.appendChild(score);

      const frameLabel=document.createElement("div");
      frameLabel.className="frame-label";
      frameLabel.textContent=`Frame ${f}`;
      frame.appendChild(frameLabel);

      player.frames.push(frame);
      frames.appendChild(frame);

      [input1,input2,frame.input3].forEach((inp,index)=>{
        if(!inp) return;
        inp.addEventListener("input",()=>{
          const val=inp.value.toUpperCase();
          if(val==="X" && index===0 && f<10){
            inp.value="X"; frame.input2.value="";
            moveToNextFrame(player,f);
          } else if(val==="/" && index===1){
          } else if(val!=="" && index<2){
            autoTab(frame,inp,index);
          }
          updateScores(player);
        });
      });
    }
    player.appendChild(frames);
    teamContainer.appendChild(player);
  }

  scoreboard.appendChild(teamContainer);
}

function autoTab(frame,inp,index){
  const inputs=frame.querySelectorAll("input");
  if(index<inputs.length-1) inputs[index+1].focus();
}

function moveToNextFrame(player,currentFrame){
  if(currentFrame>=player.frames.length-1) return;
  const nextFrame=player.frames[currentFrame+1];
  const nextInput=nextFrame.querySelector("input");
  if(nextInput) nextInput.focus();
}

function convertRoll(val){
  if(val==="-") return 0;
  if(!isNaN(val) && val!=="") return parseInt(val);
  if(val.toUpperCase()==="X") return 10;
  return 0;
}

function nextValidRoll(rolls,start){
  for(let i=start;i<rolls.length;i++){
    if(rolls[i]!=="") return convertRoll(rolls[i]);
  }
  return null;
}

function calculateFrameScores(player){
  const rolls=[];
  player.frames.forEach(f=>{
    [f.input1,f.input2,f.input3].forEach(inp=>{
      if(inp && inp.value!=="") rolls.push(inp.value.toUpperCase());
    });
  });
  const frameScores=[];
  let rollIndex=0;

  for(let f=0;f<10;f++){
    if(rollIndex>=rolls.length) break;
    const first=rolls[rollIndex];
    const second=rolls[rollIndex+1];
    const third=rolls[rollIndex+2];
    const firstVal=convertRoll(first);
    const secondVal=(second==="/"? 10-firstVal : convertRoll(second));
    const thirdVal=convertRoll(third);
    let frameScore=null;

    if(f<9){
      if(first==="X"){
        const bonus1=nextValidRoll(rolls,rollIndex+1);
        const bonus2=nextValidRoll(rolls,rollIndex+2);
        if(bonus1!==null && bonus2!==null) frameScore=10+bonus1+bonus2;
        rollIndex+=1;
      } else if(second==="/"){
        const bonus=nextValidRoll(rolls,rollIndex+2);
        if(bonus!==null) frameScore=10+bonus;
        rollIndex+=2;
      } else {
        frameScore=firstVal+secondVal;
        rollIndex+=2;
      }
    } else frameScore=firstVal+secondVal+thirdVal;

    frameScores.push(frameScore);
  }
  return frameScores;
}

function updateScores(player){
  const frameScores=calculateFrameScores(player);
  let runningTotal=0;
  player.frames.forEach((f,i)=>{
    let rawScore=0;
    if(f.input1.value) rawScore+=convertRoll(f.input1.value);
    if(f.input2.value && f.input2.value!=="/") rawScore+=convertRoll(f.input2.value);
    if(f.input3 && f.input3.value) rawScore+=convertRoll(f.input3.value);

    let displayText=`${rawScore}`;
    if(frameScores[i]!==null && frameScores[i]!==undefined){
      runningTotal+=frameScores[i];
      displayText+=` | Total: ${runningTotal}`;
    }
    f.querySelector(".score").textContent=displayText;
    f.querySelector(".score").style.visibility="visible";
  });
  buildTeamTotal(document.getElementById("scoreboard"));
}

function buildTeamTotal(scoreboard){
  const existingTotals=document.querySelectorAll(".team-total");
  existingTotals.forEach(t=>t.remove());
  const teamTotals=document.createElement("div");
  teamTotals.className="team-total";
  const teams=scoreboard.querySelectorAll(".team-container");
  teams.forEach(team=>{
    let total=0;
    team.querySelectorAll(".player").forEach(player=>{
      const fs=calculateFrameScores(player);
      total+=fs.reduce((a,b)=>a+b,0);
    });
    const tdiv=document.createElement("div");
    tdiv.textContent=`${team.querySelector("h2").textContent} Total: ${total}`;
    teamTotals.appendChild(tdiv);
  });
  scoreboard.appendChild(teamTotals);
}
</script>
</body>
</html>
