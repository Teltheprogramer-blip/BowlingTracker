<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bowling Party!!! (Web-App Companion)</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #222;
  color: #fff;
  margin: 0;
  padding: 0;
}
.title-container { margin-top: 20px; }
.title-image { max-width: 90%; height: auto; }
.logo-container { text-align: center; margin: 30px 0; }
.logo-image { max-width: 140px; height: auto; opacity: 0.9; }
.controls { margin: 20px; }
select, button { padding: 10px; font-size: 18px; margin: 5px; border-radius: 8px; }
.team-container { display: flex; flex-direction: column; align-items: center; margin: 20px 0; }
.scoreboard { display: flex; flex-direction: column; align-items: center; margin: 20px auto; max-width: 95%; }
.player { margin: 20px 0; border: 2px solid #555; border-radius: 12px; padding: 10px; width: 100%; background: #333; }
.player h3 { margin-bottom: 10px; }
.frames { display: flex; flex-direction: row; justify-content: flex-start; flex-wrap: nowrap; overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; max-width: 95vw; margin: 0 auto; }
.frame { border: 1px solid #777; margin: 2px; padding: 8px; min-width: 55px; background: #444; border-radius: 8px; font-size: 18px; flex: 0 0 auto; position: relative; }
.inputs { display: flex; justify-content: center; margin-bottom: 5px; }
.inputs input { width: 24px; height: 24px; text-align: center; margin: 0 2px; font-size: 18px; border-radius: 4px; border: none; background: #fff; color: #000; }
.score { font-size: 20px; font-weight: bold; color: #ffcc00; visibility: hidden; }
.frame-label { position: absolute; bottom: -20px; width: 100%; font-size: 14px; color: #aaa; }
.active-frame { border: 2px solid #ffcc00; }
.team-total { font-size: 22px; font-weight: bold; margin-top: 10px; color: #0f0; }
</style>
</head>
<body>

<div class="title-container">
  <img src="assets/bowling party.jpg" alt="Bowling Party!!!" class="title-image">
</div>

<div class="controls">
  <h2>üé≥ Team Setup üé≥</h2>
  <p>Select up to 5 players per team or single player mode.</p>
  <div>
    <button onclick="startSinglePlayer()">Single Player üïπÔ∏è</button>
    <button onclick="startTeamGame()">Team Mode üë•</button>
  </div>
</div>

<div id="scoreboard" class="scoreboard"></div>

<div class="logo-container">
  <img src="assets/SCG Logo.jpg" alt="SCG Logo" class="logo-image">
</div>

<script>
const archetypes=[
  {name:"Tilly", handicap:39, average:166},
  {name:"Debbie", handicap:71, average:121},
  {name:"Robert", handicap:-59, average:279},
  {name:"Samuel", handicap:19, average:188},
  {name:"Peyton", handicap:-27, average:241},
  {name:"Amara", handicap:-40, average:255},
  {name:"Tito", handicap:27, average:180},
  {name:"Wendy", handicap:-46, average:262},
  {name:"David", handicap:32, average:174},
  {name:"Marcus", handicap:49, average:156},
  {name:"Jacob", handicap:58, average:145},
  {name:"Amanda", handicap:32, average:164}
];

function startSinglePlayer(){
  const scoreboard=document.getElementById("scoreboard");
  scoreboard.innerHTML="";
  buildTeam(scoreboard,"Player",1,true);
}

function startTeamGame(){
  const team1Count=prompt("How many players on Team 1? (1-5)", "2");
  const team2Count=prompt("How many players on Team 2? (1-5)", "2");
  const scoreboard=document.getElementById("scoreboard");
  scoreboard.innerHTML="";
  buildTeam(scoreboard,"Team 1",parseInt(team1Count));
  buildTeam(scoreboard,"Team 2",parseInt(team2Count));
  buildTeamTotal(scoreboard);
}

function buildTeam(scoreboard,teamName,playerCount,single=false){
  const teamContainer=document.createElement("div");
  teamContainer.className="team-container";
  const teamTitle=document.createElement("h2");
  teamTitle.textContent=`üî• ${teamName} üî•`;
  teamContainer.appendChild(teamTitle);

  for(let i=0;i<playerCount;i++){
    const player=document.createElement("div");
    player.className="player";
    const playerName=document.createElement("h3");
    const select=document.createElement("select");
    archetypes.forEach(arc=>{
      const option=document.createElement("option");
      option.value=arc.name;
      option.textContent=`${arc.name} (Avg:${arc.average}, HCP:${arc.handicap})`;
      select.appendChild(option);
    });
    playerName.appendChild(select);
    player.appendChild(playerName);

    const frames=document.createElement("div");
    frames.className="frames";
    player.frames=[];

    for(let f=1;f<=10;f++){
      const frame=document.createElement("div");
      frame.className="frame";
      const inputs=document.createElement("div");
      inputs.className="inputs";

      const input1=document.createElement("input");
      const input2=document.createElement("input");
      input1.maxLength=1; input2.maxLength=1;
      inputs.appendChild(input1); inputs.appendChild(input2);

      if(f===10){
        const input3=document.createElement("input"); input3.maxLength=1;
        inputs.appendChild(input3);
      }

      frame.appendChild(inputs);

      const score=document.createElement("div");
      score.className="score";
      score.textContent="0";
      frame.appendChild(score);

      const frameLabel=document.createElement("div");
      frameLabel.className="frame-label";
      frameLabel.textContent=`Frame ${f}`;
      frame.appendChild(frameLabel);

      player.frames.push(frame);
      frames.appendChild(frame);

      // Input event
      [input1,input2,input3].forEach((inp,index)=>{
        if(!inp) return;
        inp.addEventListener("input",()=>{
          // Auto-tab logic
          if(inp.value.toUpperCase()==="X" && index===0 && f<10){
            input1.value="X"; input2.value="";
            moveToNextFrame(player,f);
          } else if(inp.value==="/" && index===1){
            // do nothing special
          } else if(inp.value==="" && index<2){
            return;
          } else if(index===0 || index===1){
            autoTab(frame,inp,index);
          }
          updateScores(player);
        });
      });
    }

    player.appendChild(frames);
    teamContainer.appendChild(player);
  }

  scoreboard.appendChild(teamContainer);
}

// Auto-tab helper
function autoTab(frame,inp,index){
  const inputs=frame.querySelectorAll("input");
  if(index<inputs.length-1) inputs[index+1].focus();
}

// Move to next frame after strike
function moveToNextFrame(player,currentFrame){
  if(currentFrame>=player.frames.length-1) return;
  const nextFrame=player.frames[currentFrame+1];
  const nextInput=nextFrame.querySelector("input");
  if(nextInput) nextInput.focus();
}

// Convert roll input to numeric
function convertRoll(val){
  if(val==="-") return 0;
  if(!isNaN(val) && val!=="") return parseInt(val);
  if(val.toUpperCase()==="X") return 10;
  return 0;
}

// Find next valid roll for scoring
function nextValidRoll(rolls,start){
  for(let i=start;i<rolls.length;i++){
    if(rolls[i]!=="") return convertRoll(rolls[i]);
  }
  return 0;
}

// Calculate frame scores
function calculateFrameScores(player){
  const rolls=[];
  player.frames.forEach(f=>{
    [f.input1,f.input2,f.input3].forEach(inp=>{
      if(inp && inp.value!=="") rolls.push(inp.value.toUpperCase());
    });
  });
  const frameScores=[];
  let rollIndex=0;

  for(let f=0;f<10;f++){
    if(rollIndex>=rolls.length) break;
    let first=rolls[rollIndex];
    let second=rolls[rollIndex+1];
    let third=rolls[rollIndex+2];
    const firstVal=convertRoll(first);
    let secondVal=(second==="/"? 10-firstVal : convertRoll(second));
    const thirdVal=convertRoll(third);
    let frameScore=0;

    if(f<9){
      if(first==="X"){
        const bonus1=nextValidRoll(rolls,rollIndex+1);
        const bonus2=nextValidRoll(rolls,rollIndex+2);
        frameScore=10+bonus1+bonus2;
        rollIndex+=1;
      } else if(second==="/"){
        const bonus=nextValidRoll(rolls,rollIndex+2);
        frameScore=10+bonus;
        rollIndex+=2;
      } else {
        frameScore=firstVal+secondVal;
        rollIndex+=2;
      }
    } else { // 10th frame
      if(second==="/"){
        frameScore=10+thirdVal;
        rollIndex+=3;
      } else if(first==="X"){
        frameScore=firstVal+secondVal+thirdVal;
        rollIndex+=3;
      } else {
        frameScore=firstVal+secondVal;
        rollIndex+=2;
      }
    }

    frameScores.push(frameScore);
  }
  return frameScores;
}

// Update running totals live
function updateScores(player){
  const frameScores=calculateFrameScores(player);
  let runningTotal=0;
  player.frames.forEach((f,idx)=>{
    const scoreDiv=f.querySelector(".score");
    if(frameScores[idx]!==undefined){
      scoreDiv.style.visibility="visible";
      runningTotal+=frameScores[idx];
      scoreDiv.textContent=runningTotal;
    } else {
      scoreDiv.style.visibility="hidden";
      scoreDiv.textContent="0";
    }
  });
}

// Team total display
function buildTeamTotal(scoreboard){
  const teams=scoreboard.querySelectorAll(".team-container");
  teams.forEach(team=>{
    let total=0;
    const players=team.querySelectorAll(".player");
    players.forEach(p=>{
      const lastFrame=p.frames[9];
      const frameScore=lastFrame.querySelector(".score").textContent;
      total+=parseInt(frameScore)||0;
    });
    const teamTotal=document.createElement("div");
    teamTotal.className="team-total";
    teamTotal.textContent=`${team.querySelector("h2").textContent} Total: ${total}`;
    team.appendChild(teamTotal);
  });
}
</script>
</body>
</html>
